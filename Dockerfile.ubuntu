FROM ubuntu:14.04
MAINTAINER DrTrigon <dr.trigon@surfeu.ch>

# LABEL author.user1="DrTrigon <dr.trigon@surfeu.ch>"

# Environment Variables
ENV ARDUINO_VERSION 1.8.2
#ENV BOARD "arduino:avr:nano:cpu=atmega328"

# Initial update
RUN apt-get -y update

# Basic packages
RUN apt-get install -y \
#  build-essential \
#  make \
  git

# wget
RUN apt-get install -y wget

# xz (for tar)
RUN apt-get install -y xz-utils

# tree
RUN apt-get install -y tree

# Arduino IDE
RUN wget http://downloads.arduino.cc/arduino-$ARDUINO_VERSION-linux64.tar.xz
RUN tar xf arduino-$ARDUINO_VERSION-linux64.tar.xz
RUN sudo mv arduino-$ARDUINO_VERSION /usr/local/share/arduino
RUN sudo ln -s /usr/local/share/arduino/arduino /usr/local/bin/arduino

### END docker-arduino / START individual dockers resp. testing of docker-arduino ###

RUN git clone https://github.com/drtrigon/sketchbook.git

# setup a pseudo-display
#RUN "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_1.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :1 -ac -screen 0 1280x1024x16"

#RUN sleep 3

#RUN export DISPLAY=:1.0


# run arduin verify
#CMD ls -la sketchbook/MultiWii_2_4/MultiWii/MultiWii.ino 1>&2
#CMD ls -la $PWD/sketchbook/MultiWii_2_4/MultiWii/MultiWii.ino 2>&1
CMD ls -la sketchbook/MultiWii_2_4/MultiWii/
CMD ls -la $PWD/sketchbook/MultiWii_2_4/MultiWii/
#CMD arduino --verify --board $BOARD --verbose --preserve-temp-files $PWD/MultiWii_2_4/MultiWii/MultiWii.ino
CMD arduino --verify --board $BOARD --verbose --preserve-temp-files sketchbook/MultiWii_2_4/MultiWii/MultiWii.ino


RUN tree


# verify code, generate elf+hex

# using USB hardware bridge/forward (all os?) me be we could use it to upload code
